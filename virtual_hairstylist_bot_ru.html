<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –°—Ç–∏–ª–∏—Å—Ç AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; touch-action: manipulation; }
        .loader { border-top-color: #3498db; -webkit-animation: spin 1s linear infinite; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .glass-effect { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .animated-gradient { background-size: 200% 200%; animation: gradient-animation 10s ease infinite; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .image-container img { object-fit: contain; } 
        .image-container .placeholder { aspect-ratio: 1 / 1; object-fit: cover; } 
        .modal-image-animation { animation: zoomIn 0.3s ease-out; }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        [x-cloak] { display: none !important; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('imageGenerator', () => ({
                clientPhoto: { file: null, preview: null },
                stylePhoto: { file: null, preview: null },
                generatedImage: { preview: null },
                prompt: '',
                loading: false,
                statusText: '–ú–∞–≥–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...',
                modal: { visible: false, title: '', content: '', type: 'text' },
                animation: { timer: null, isOriginal: true },
                
                generationCount: 0,
                maxGenerations: 10,
                isPro: false,
                promoCode: '',
                correctPromoCode: 'STILIST',
                testPromoCode: 'TEST30',

                init() {
                    const savedCount = localStorage.getItem('generationCount_v2');
                    this.generationCount = savedCount ? parseInt(savedCount, 10) : 0;
                    
                    const proStatus = localStorage.getItem('isPro_v2');
                    this.isPro = proStatus === 'true';

                    const maxGen = localStorage.getItem('maxGenerations_v2');
                    this.maxGenerations = maxGen ? parseInt(maxGen, 10) : 10;
                },

                applyPromoCode() {
                    const code = this.promoCode.trim().toUpperCase();
                    if (code === this.correctPromoCode.toUpperCase()) {
                        this.isPro = true;
                        localStorage.setItem('isPro_v2', 'true');
                        this.openModal('–ü—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è PRO-–¥–æ—Å—Ç—É–ø–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω! –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–Ω—è—Ç—ã.', '–£—Å–ø–µ—Ö!', 'text');
                    } else if (code === this.testPromoCode.toUpperCase()) {
                        this.maxGenerations += 30;
                        localStorage.setItem('maxGenerations_v2', this.maxGenerations);
                        this.openModal('–í–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–æ 30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π!', '–£—Å–ø–µ—Ö!', 'text');
                    } else {
                        this.openModal('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥.', '–û—à–∏–±–∫–∞', 'text');
                    }
                    this.promoCode = '';
                },
                
                handleFileSelect(event, photoType) { const file = event.target.files[0]; if (file) this.processFile(file, photoType); },
                handleFileDrop(event, photoType) { const file = event.dataTransfer.files[0]; if (file) this.processFile(file, photoType); },
                processFile(file, photoType) {
                    if (!file.type.startsWith('image/')) { this.showErrorModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.'); return; }
                    const reader = new FileReader();
                    reader.onload = (e) => { this[photoType].preview = e.target.result; };
                    reader.readAsDataURL(file);
                    this.toBase64(file).then(base64 => { this[photoType].file = base64; });
                },
                toBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = error => reject(error); }); },
                openModal(content, title = '–ü—Ä–æ—Å–º–æ—Ç—Ä', type = 'image') { this.modal = { visible: true, title, content, type }; if (type === 'animation') this.startAnimation(); },
                closeModal() { this.modal.visible = false; clearInterval(this.animation.timer); },
                showErrorModal(message) { this.loading = false; this.openModal(message, '–û—à–∏–±–∫–∞', 'text'); },
                resetAll() { this.clientPhoto = { file: null, preview: null }; this.stylePhoto = { file: null, preview: null }; this.generatedImage = { preview: null }; this.prompt = ''; this.$refs.clientPhotoInput.value = ''; this.$refs.stylePhotoInput.value = ''; },
                createAnimation() { this.openModal('', '–ê–Ω–∏–º–∞—Ü–∏—è –î–æ/–ü–æ—Å–ª–µ', 'animation'); },
                startAnimation() { this.animation.isOriginal = true; this.animation.timer = setInterval(() => { this.animation.isOriginal = !this.animation.isOriginal; }, 1500); },

                async callProxy(targetApi, payload) {
                    this.loading = true;
                    const proxyUrl = 'https://virtual-hairstylist-production.up.railway.app'; 
                    try {
                        const response = await fetch(`${proxyUrl}/api/proxy`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target_api: targetApi, payload: payload })
                        });
                        if (!response.ok) {
                            const errorText = await response.text();
                            try { const errorBody = JSON.parse(errorText); throw new Error(`HTTP error! status: ${response.status}, message: ${errorBody.error?.message || errorText}`); } catch (e) { throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`); }
                        }
                        return await response.json();
                    } catch (error) {
                        console.error('Proxy Error:', error);
                        this.showErrorModal('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É. –î–µ—Ç–∞–ª–∏: ' + error.message);
                        return null;
                    } finally {
                        this.loading = false;
                    }
                },

                async generateImage(isUpscale) {
                    if (!this.isPro && this.generationCount >= this.maxGenerations) {
                        this.showErrorModal(`–í—ã –∏—Å—á–µ—Ä–ø–∞–ª–∏ –ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π (${this.maxGenerations}). –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.`);
                        return;
                    }
                    this.statusText = isUpscale ? 'Improving quality...' : 'Generating new look...';
                    let userPrompt = this.prompt || "a new hairstyle";
                    if (isUpscale) { userPrompt = "improve quality, high detail, 4k. " + userPrompt; }
                    
                    const systemPrompt = `You are an expert photorealistic AI hairstylist. Your task is to meticulously replace the hair on a person's photo according to a user's request.
                    PRIMARY DIRECTIVE: First, digitally REMOVE the original hair completely. Then, render the NEW hairstyle. This is crucial to avoid layering new hair on top of old hair.
                    ABSOLUTE REQUIREMENT: The face, facial features, expression, skin, clothing, and background MUST remain COMPLETELY UNCHANGED. Only the hair (style, color, length) should be modified.
                    Maintain the original photo's quality, lighting, and style. The result must be photorealistic.`;
                    
                    const payload = { contents: [{ parts: [ { text: systemPrompt }, { text: `CLIENT REQUEST: ${userPrompt}` }, { inlineData: { mimeType: "image/jpeg", data: this.clientPhoto.file } } ] }], generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }, };
                    
                    if (this.stylePhoto.file) { 
                        payload.contents[0].parts.push({ text: "USE THIS PHOTO AS A STYLE REFERENCE FOR THE HAIRSTYLE. Match the color, length, texture, and style as closely as possible:" }); 
                        payload.contents[0].parts.push({ inlineData: { mimeType: "image/jpeg", data: this.stylePhoto.file } }); 
                    }

                    const result = await this.callProxy('image', payload);
                    if (result) {
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (base64Data) { 
                            this.generatedImage.preview = `data:image/png;base64,${base64Data}`;
                            if (!isUpscale && !this.isPro) {
                                this.generationCount++;
                                localStorage.setItem('generationCount_v2', this.generationCount);
                            }
                        } 
                        else { const errorMessage = result?.error?.message || 'The AI response did not contain an image.'; this.showErrorModal(errorMessage); }
                    }
                },
                async callLLM(systemPrompt, userPrompt, imageFile = null) {
                    const payload = { contents: [{ parts: [{ text: userPrompt }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
                    if(imageFile) { payload.contents[0].parts.push({ inlineData: { mimeType: "image/jpeg", data: imageFile } }); }
                    const result = await this.callProxy('text', payload);
                    if (result) { const text = result?.candidates?.[0]?.content?.parts?.[0]?.text; if (text) { return text; } }
                    this.showErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏.');
                    return null;
                },
                async getHairstyleSuggestions() {
                    const systemPrompt = "You are an expert hairstylist. Analyze the client's photo and briefly, in a list format (using *), suggest 3-4 haircuts or styles that would suit their face shape. Respond in Russian.";
                    const userPrompt = "–ü–æ—Å–æ–≤–µ—Ç—É–π, –∫–∞–∫–∏–µ –ø—Ä–∏—á–µ—Å–∫–∏ –º–Ω–µ –ø–æ–¥–æ–π–¥—É—Ç?";
                    const result = await this.callLLM(systemPrompt, userPrompt, this.clientPhoto.file);
                    if (result) { this.openModal(result.replace(/\*/g, '‚Ä¢'), '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏—á–µ—Å–∫–∞–º', 'text'); }
                },
                async describeHairstyle() {
                    const systemPrompt = "You are a professional hairstylist. Describe the hairstyle in the photo. Specify the cut type, length, color, and styling. Be brief and precise. Respond in Russian.";
                    const userPrompt = "–û–ø–∏—à–∏ —ç—Ç—É –ø—Ä–∏—á–µ—Å–∫—É.";
                    const result = await this.callLLM(systemPrompt, userPrompt, this.stylePhoto.file);
                    if (result) { this.prompt = result; }
                }
            }));
        });
    </script>
</head>
<body class="bg-gray-900 text-white min-h-screen antialiased animated-gradient bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">

<div x-data="imageGenerator" x-init="init()" class="container mx-auto max-w-4xl p-4">
    <header class="text-center my-6"><h1 class="text-4xl md:text-5xl font-bold tracking-tight">–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –°—Ç–∏–ª–∏—Å—Ç <span class="text-purple-400">AI</span></h1><p class="text-gray-300 mt-2 text-lg">–ü—Ä–∏–º–µ—Ä—å—Ç–µ –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑ –∑–∞ —Å–µ–∫—É–Ω–¥—ã</p></header>

    <!-- –ù–æ–≤—ã–π –±–ª–æ–∫ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ -->
    <div class="mb-8 glass-effect rounded-2xl p-4 text-sm text-gray-300">
        <h4 class="font-semibold text-lg text-white mb-2 text-center">üí° –°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h4>
        <ul class="list-disc list-inside space-y-1">
            <li><b>–§–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞:</b> –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ñ–æ—Ç–æ –∞–Ω—Ñ–∞—Å, —Å —Ö–æ—Ä–æ—à–∏–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º, –≥–¥–µ –≤–æ–ª–æ—Å—ã —á–µ—Ç–∫–æ –≤–∏–¥–Ω—ã –∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç—ã —Ä—É–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏.</li>
            <li><b>–§–æ—Ç–æ-–ø—Ä–∏–º–µ—Ä:</b> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≥–¥–µ –ø—Ä–∏—á–µ—Å–∫–∞ —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω–∞ –Ω–∞ –º–æ–¥–µ–ª–∏, —Å–º–æ—Ç—Ä—è—â–µ–π –ø—Ä—è–º–æ –≤ –∫–∞–º–µ—Ä—É.</li>
            <li><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–¥–æ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ-–ø—Ä–∏–º–µ—Ä–∞! –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ü–≤–µ—Ç, –¥–ª–∏–Ω—É, –Ω–∞–ª–∏—á–∏–µ —á–µ–ª–∫–∏ –∏ —Ç–∏–ø —É–∫–ª–∞–¥–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–ª–∏–Ω–Ω—ã–µ –ø—Ä—è–º—ã–µ –ø–ª–∞—Ç–∏–Ω–æ–≤—ã–µ –≤–æ–ª–æ—Å—ã —Å —á–µ–ª–∫–æ–π').</li>
        </ul>
    </div>

    <div x-show="!isPro" x-cloak class="mb-6 glass-effect rounded-2xl p-4 text-center">
        <p class="mb-2 font-semibold">–û—Å—Ç–∞–ª–æ—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π: <span x-text="Math.max(0, maxGenerations - generationCount)" class="text-purple-400 text-lg"></span> / <span x-text="maxGenerations"></span></p>
        <div class="flex justify-center mt-2"><input type="text" x-model="promoCode" @keyup.enter="applyPromoCode()" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full md:w-1/2 p-2.5" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥"><button @click="applyPromoCode()" class="ml-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
        <div class="glass-effect rounded-2xl p-6 space-y-6">
            <div>
                <h3 class="text-lg font-semibold mb-3 border-b-2 border-purple-500 pb-2">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ñ–æ—Ç–æ</h3>
                <div @dragover.prevent @drop.prevent="handleFileDrop($event, 'clientPhoto')" class="image-container relative bg-gray-800 rounded-lg h-64 flex items-center justify-center border-2 border-dashed border-gray-600 hover:border-purple-500 transition-colors cursor-pointer" @click="$refs.clientPhotoInput.click()"><template x-if="!clientPhoto.preview"><div class="text-center text-gray-400 placeholder"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><p class="mt-2">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</p></div></template><template x-if="clientPhoto.preview"><img :src="clientPhoto.preview" alt="–§–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞" class="rounded-lg h-full w-full" @click.stop="openModal(clientPhoto.preview)"></template></div>
                <input type="file" x-ref="clientPhotoInput" @change="handleFileSelect($event, 'clientPhoto')" accept="image/*" class="hidden">
                <button x-show="clientPhoto.preview" @click="getHairstyleSuggestions()" :disabled="loading" class="w-full mt-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center"><svg x-show="!loading" class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" /></svg><span x-text="loading ? '–ê–Ω–∞–ª–∏–∑...' : '‚ú® –ü–æ–¥–æ–±—Ä–∞—Ç—å –ø—Ä–∏—á–µ—Å–∫—É –ø–æ —Ñ–æ—Ç–æ'"></span></button>
            </div>
            <div>
                <h3 class="text-lg font-semibold mb-3 border-b-2 border-purple-500 pb-2">2. –û–ø–∏—à–∏—Ç–µ –∏–ª–∏ –ø–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–µ—Å–∫—É</h3>
                <textarea x-model="prompt" rows="3" class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–ª–∏–Ω–Ω—ã–µ –≤–æ–ª–Ω–∏—Å—Ç—ã–µ –≤–æ–ª–æ—Å—ã –º–µ–¥–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞..."></textarea>
                <p class="text-center text-gray-400 my-2">-- –ò–õ–ò --</p>
                <div @dragover.prevent @drop.prevent="handleFileDrop($event, 'stylePhoto')" class="image-container relative bg-gray-800 rounded-lg h-48 flex items-center justify-center border-2 border-dashed border-gray-600 hover:border-purple-500 transition-colors cursor-pointer" @click="$refs.stylePhotoInput.click()"><template x-if="!stylePhoto.preview"><div class="text-center text-gray-400 placeholder"><svg class="w-10 h-10 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-4-4V6a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7z M7 16v-8m0 8a2 2 0 100-4 2 2 0 000 4z"/></svg><p class="mt-2">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ-–ø—Ä–∏–º–µ—Ä</p></div></template><template x-if="stylePhoto.preview"><img :src="stylePhoto.preview" alt="–§–æ—Ç–æ –ø—Ä–∏—á–µ—Å–∫–∏" class="rounded-lg h-full w-full" @click.stop="openModal(stylePhoto.preview)"></template></div>
                <input type="file" x-ref="stylePhotoInput" @change="handleFileSelect($event, 'stylePhoto')" accept="image/*" class="hidden">
                <button x-show="stylePhoto.preview" @click="describeHairstyle()" :disabled="loading" class="w-full mt-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center"><svg x-show="!loading" class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.375 6.75h17.25M3.375 12h17.25M3.375 17.25h17.25" /></svg><span x-text="loading ? '–û–ø–∏—Å–∞–Ω–∏–µ...' : '‚ú® –û–ø–∏—Å–∞—Ç—å –ø—Ä–∏—á–µ—Å–∫—É —Å —Ñ–æ—Ç–æ'"></span></button>
            </div>
            <button @click="generateImage(false)" :disabled="loading || !clientPhoto.file || (!prompt && !stylePhoto.file) || (!isPro && generationCount >= maxGenerations)" class="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white font-bold py-3 px-4 rounded-lg text-lg transition transform hover:scale-105"><span x-show="!loading">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑</span><span x-show="loading">–°–æ–∑–¥–∞–Ω–∏–µ...</span></button>
            <button @click="resetAll()" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition">–°–ë–†–û–°</button>
        </div>
        <div class="glass-effect rounded-2xl p-6 space-y-6">
            <h3 class="text-lg font-semibold mb-3 border-b-2 border-purple-500 pb-2">3. –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <div class="image-container relative bg-gray-800 rounded-lg min-h-[256px] flex items-center justify-center border-2 border-gray-700"><template x-if="!loading && !generatedImage.preview"><div class="text-center text-gray-400"><svg class="w-12 h-12 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a12.022 12.022 0 01-11.68 0 6 6 0 1111.68 0z" /></svg><p class="mt-2">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≤–∞—à–∞ –Ω–æ–≤–∞—è –ø—Ä–∏—á–µ—Å–∫–∞</p></div></template><div x-show="loading" class="flex flex-col items-center justify-center"><div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24 mb-4"></div><p class="text-lg text-gray-300" x-text="statusText"></p></div><template x-if="generatedImage.preview"><img :src="generatedImage.preview" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="rounded-lg max-h-[50vh] w-auto max-w-full" @click.stop="openModal(generatedImage.preview)"></template></div>
            <div class="grid grid-cols-2 gap-4" x-show="generatedImage.preview">
                <button @click="generateImage(true)" :disabled="loading" class="w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ</button>
                <button @click="createAnimation()" :disabled="loading" class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>–ê–Ω–∏–º–∞—Ü–∏—è –î–æ/–ü–æ—Å–ª–µ</button>
            </div>
        </div>
    </div>
    <div x-show="modal.visible" x-cloak class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50" @click="closeModal()"><div class="bg-gray-800 rounded-2xl shadow-lg max-w-lg w-full p-6 text-center modal-image-animation" @click.stop><h3 class="text-2xl font-bold mb-4" x-text="modal.title"></h3><div x-show="modal.type === 'image'" class="mb-4"><img :src="modal.content" class="max-w-full max-h-[70vh] rounded-lg mx-auto"></div>
            <!-- –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–î–ï–°–¨: object-cover –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ object-contain -->
            <div x-show="modal.type === 'animation'" class="mb-4 relative w-full" style="padding-bottom: 100%;"><img :src="animation.isOriginal ? clientPhoto.preview : generatedImage.preview" class="absolute top-0 left-0 w-full h-full object-contain rounded-lg"></div>
            <div x-show="modal.type === 'text'" class="mb-4 text-left text-gray-300 whitespace-pre-wrap max-h-[60vh] overflow-y-auto" x-html="modal.content"></div><button @click="closeModal()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
</div>

</body>
</html>
